import{initModal,openModal}from"./modal.js";import{initSearch}from"./search.js";const BLOCK_HEIGHT_LIMIT=400,IMAGE_EXTENSIONS=["jpg","jpeg","png","gif","webp"],VIDEO_EXTENSIONS=["mp4","webm"],OBSERVER_OPTIONS={rootMargin:"400px 0px"},getFileExtension=e=>e.split(".").pop().toLowerCase(),isImage=e=>IMAGE_EXTENSIONS.includes(getFileExtension(e)),isVideo=e=>VIDEO_EXTENSIONS.includes(getFileExtension(e));export let activeCategory="semantic-colors";export function initMainPage(){initModal(),initSearch(),initCategoryButtons(),fetchData()}function showCategory(e){const t=document.querySelectorAll(".category"),o=document.querySelectorAll(".category-button");t.forEach((e=>{e.classList.remove("active")})),document.getElementById(e).classList.add("active"),o.forEach((t=>{t.classList.remove("active"),t.dataset.category===e&&t.classList.add("active")})),document.dispatchEvent(new CustomEvent("categoryChange",{detail:{category:e}})),activeCategory=e}function initCategoryButtons(){showCategory(activeCategory);document.querySelectorAll(".category-button").forEach((e=>{e.addEventListener("click",(()=>{showCategory(e.dataset.category)}))}))}async function fetchData(){try{const e=await fetch("data.json",{cache:"default"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();renderBlocks(t.semanticColors,"semantic-colors"),renderBlocks(t.rawColors,"raw-colors")}catch(e){}}function checkContentOverflow(e){const t=e.querySelector(".media"),o=e.querySelector(".description"),n=e.querySelector("h3"),a=e.querySelector(".id");function c(){const t=e.scrollHeight>400;e.classList.toggle("has-hidden-content",t)}c();const s=new ResizeObserver(c);s.observe(t),s.observe(o),s.observe(n),s.observe(a)}function renderBlocks(e,t){const o=document.getElementById(t);if(!o)return;o.innerHTML="";const n=[...e].sort(((e,t)=>{const o=e.title.replace(/(\d+)/,((e,t)=>String(t).padStart(10,"0"))),n=t.title.replace(/(\d+)/,((e,t)=>String(t).padStart(10,"0")));return o.localeCompare(n)})),a=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target;t.src=t.dataset.src,"VIDEO"===t.tagName&&t.load(),a.unobserve(t)}}))}),OBSERVER_OPTIONS);n.forEach((e=>{const t=createBlockElement(e,a);o.appendChild(t),checkContentOverflow(t)}))}function createBlockElement(e,t){const o=document.createElement("div");o.classList.add("bloc"),o.dataset.title=e.title.toLowerCase(),o.dataset.description=e.description.toLowerCase();const n=document.createElement("h3");n.textContent=e.title,o.appendChild(n);const a=document.createElement("p");a.classList.add("description"),a.textContent=e.description,o.appendChild(a);const c=document.createElement("div");c.classList.add("media"),e.images.forEach((o=>{if(isImage(o)){const n=document.createElement("img");n.dataset.src=o,n.alt=e.title,n.loading="lazy",c.appendChild(n),t.observe(n)}else if(isVideo(o)){const e=document.createElement("video");e.dataset.src=o,e.controls=!0,e.preload="none",e.setAttribute("playsinline","true"),c.appendChild(e),t.observe(e)}})),o.appendChild(c);const s=document.createElement("p");s.classList.add("id"),s.textContent=`ID: ${e.id}`,o.appendChild(s);const r=document.createElement("div");r.classList.add("bottom-banner"),o.appendChild(r);const i=document.createElement("button");i.classList.add("toggle-button");const d=document.createElement("span");return d.classList.add("material-symbols-rounded"),d.textContent="keyboard_arrow_down",i.appendChild(d),i.appendChild(document.createTextNode(" More")),i.onclick=()=>toggleBlock(o,i),o.appendChild(i),o}function updateButtonContent(e,t){e.innerHTML=`\n        <span class="material-symbols-rounded">\n            ${t?"keyboard_arrow_up":"keyboard_arrow_down"}\n        </span>\n        ${t?" Less":" More"}`}function toggleBlock(e,t){const o=e.classList.contains("expanded");e.classList.toggle("expanded"),o?checkContentOverflow(e):e.classList.remove("has-hidden-content"),updateButtonContent(t,e.classList.contains("expanded"))}document.addEventListener("click",(e=>{e.target.matches(".media img")&&openModal(e.target)}));