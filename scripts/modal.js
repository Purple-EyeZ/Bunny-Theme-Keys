import{activeCategory}from"./main.js";const ANIMATION_DURATION=300,SWIPE_THRESHOLD=50,SWIPE_DOWN_THRESHOLD=100,TRANSITION_EASE="transform 0.3s ease",DIRECTION={PREV:{transform:"translateX(100vw)",delta:-1},NEXT:{transform:"translateX(-100vw)",delta:1},CLOSE:{transform:"translateY(100vh)",delta:0}};let modalImages=[],currentImageIndex=0,startX=0,startY=0,currentX=0,currentY=0,isDragging=!1;const getModalElements=()=>({modal:document.getElementById("imageModal"),image:document.getElementById("modalImage"),title:document.getElementById("modalTitle"),closeBtn:document.querySelector(".close"),prevBtn:document.querySelector(".prev"),nextBtn:document.querySelector(".next")}),resetImagePosition=(e,t=!0)=>{e.style.transition=t?TRANSITION_EASE:"none",e.style.transform="translate(0, 0)"};export const initModal=()=>{const{modal:e,prevBtn:t,nextBtn:a}=getModalElements();e&&(e.addEventListener("touchstart",handleTouchStart,{passive:!0}),e.addEventListener("touchmove",handleTouchMove,{passive:!0}),e.addEventListener("touchend",handleTouchEnd),e.addEventListener("click",handleModalClick),t?.addEventListener("click",showPrevImage),a?.addEventListener("click",showNextImage),updateModalImages())};function handleModalClick(e){const{image:t,prevBtn:a,nextBtn:n,title:o}=getModalElements();[t,a,n,o].includes(e.target)||closeModal()}export function openModal(e){const{modal:t,image:a,title:n}=getModalElements();resetImagePosition(a,!1),a.src=e.dataset.src||e.src;const o=e.closest(".bloc");if(o){const e=o.querySelector("h3");n.textContent=e?e.textContent:""}updateModalImages(),currentImageIndex=modalImages.indexOf(e.dataset.src||e.src),document.body.classList.add("modal-open"),t.style.display="flex"}function closeModal(){const{modal:e,image:t}=getModalElements();t.style.transition=TRANSITION_EASE,t.style.transform=DIRECTION.CLOSE.transform,setTimeout((()=>{document.body.classList.remove("modal-open"),e.style.display="none",resetImagePosition(t,!1),currentX=0,currentY=0,isDragging=!1}),250)}function handleTouchStart(e){const{image:t}=getModalElements();startX=e.touches[0].clientX,startY=e.touches[0].clientY,isDragging=!0,t.style.transition="none"}function handleTouchMove(e){if(!isDragging)return;const{image:t}=getModalElements(),a=e.touches[0].clientX-startX,n=e.touches[0].clientY-startY,o=Math.abs(n)>Math.abs(a);currentX=o?0:a,currentY=o?Math.max(0,n):0,t.style.transform=`translate(${currentX}px, ${currentY}px)`}function handleTouchEnd(){isDragging=!1;const{image:e}=getModalElements(),t=currentX,a=currentY;Math.abs(a)>Math.abs(t)?a>100?closeModal():resetImagePosition(e):t>50?showPrevImage():t<-50?showNextImage():resetImagePosition(e)}function changeImage(e){if(0===modalImages.length)return;const{image:t}=getModalElements();t.style.transition=TRANSITION_EASE,t.style.transform=e.transform,setTimeout((()=>{currentImageIndex=(currentImageIndex+e.delta+modalImages.length)%modalImages.length,loadCurrentImage(),updateModalTitle(),isDragging=!1,currentX=currentY=0}),300),preloadAdjacentImages(currentImageIndex)}const showPrevImage=()=>changeImage(DIRECTION.PREV),showNextImage=()=>changeImage(DIRECTION.NEXT);function updateModalTitle(){const{title:e}=getModalElements(),t=modalImages[currentImageIndex],a=Array.from(document.querySelectorAll(".bloc")).find((e=>Array.from(e.querySelectorAll(".media img")).some((e=>e.dataset.src===t||e.src===t))));if(a){const t=a.querySelector("h3");e.textContent=t?t.textContent:""}}function updateModalImages(){modalImages=Array.from(document.querySelectorAll(`#${activeCategory} .media img`)).map((e=>e.dataset.src||e.src))}function loadCurrentImage(){const{image:e}=getModalElements();e.src=modalImages[currentImageIndex],resetImagePosition(e,!1)}function preloadAdjacentImages(e){if(modalImages.length>0){const t=(e-1+modalImages.length)%modalImages.length,a=(e+1)%modalImages.length;preloadImage(modalImages[t]),preloadImage(modalImages[a])}}function preloadImage(e){(new Image).src=e}