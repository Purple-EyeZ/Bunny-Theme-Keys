import{activeCategory as A}from"./main.js";const h=300,I=50,L=100,f="transform 0.3s ease",g={PREV:{transform:"translateX(100vw)",delta:-1},NEXT:{transform:"translateX(-100vw)",delta:1},CLOSE:{transform:"translateY(100vh)",delta:0}};let o=[],r=0,E=0,y=0,c=0,m=0,d=!1;const l=()=>({modal:document.getElementById("imageModal"),image:document.getElementById("modalImage"),title:document.getElementById("modalTitle"),closeBtn:document.querySelector(".close"),prevBtn:document.querySelector(".prev"),nextBtn:document.querySelector(".next")}),i=(e,t=!0)=>{e.style.transition=t?f:"none",e.style.transform="translate(0, 0)"};export const initModal=()=>{const{modal:e,prevBtn:t,nextBtn:n}=l();e&&(e.addEventListener("touchstart",C,{passive:!0}),e.addEventListener("touchmove",N,{passive:!0}),e.addEventListener("touchend",O),e.addEventListener("click",b),t==null||t.addEventListener("click",v),n==null||n.addEventListener("click",S),T())};function b(e){const{image:t,prevBtn:n,nextBtn:a,title:s}=l();[t,n,a,s].includes(e.target)||p()}export function openModal(e){const{modal:t,image:n,title:a}=l();i(n,!1),n.src=e.dataset.src||e.src;const s=e.closest(".bloc");if(s){const u=s.querySelector("h3");a.textContent=u?u.textContent:""}T(),r=o.indexOf(e.dataset.src||e.src),document.body.classList.add("modal-open"),t.style.display="flex"}function p(){const{modal:e,image:t}=l();t.style.transition=f,t.style.transform=g.CLOSE.transform,setTimeout(()=>{document.body.classList.remove("modal-open"),e.style.display="none",i(t,!1),c=0,m=0,d=!1},h-50)}function C(e){const{image:t}=l();E=e.touches[0].clientX,y=e.touches[0].clientY,d=!0,t.style.transition="none"}function N(e){if(!d)return;const{image:t}=l(),n=e.touches[0].clientX-E,a=e.touches[0].clientY-y,s=Math.abs(a)>Math.abs(n);c=s?0:n,m=s?Math.max(0,a):0,t.style.transform=`translate(${c}px, ${m}px)`}function O(){d=!1;const{image:e}=l(),t=c,n=m;Math.abs(n)>Math.abs(t)?n>L?p():i(e):t>I?v():t<-I?S():i(e)}function x(e){if(o.length===0)return;const{image:t}=l();t.style.transition=f,t.style.transform=e.transform,setTimeout(()=>{r=(r+e.delta+o.length)%o.length,q(),X(),d=!1,c=m=0},h),R(r)}const v=()=>x(g.PREV),S=()=>x(g.NEXT);function X(){const{title:e}=l(),t=o[r],n=Array.from(document.querySelectorAll(".bloc")).find(a=>Array.from(a.querySelectorAll(".media img")).some(s=>s.dataset.src===t||s.src===t));if(n){const a=n.querySelector("h3");e.textContent=a?a.textContent:""}}function T(){o=Array.from(document.querySelectorAll(`#${A} .media img`)).map(e=>e.dataset.src||e.src)}function q(){const{image:e}=l();e.src=o[r],i(e,!1)}function R(e){if(o.length>0){const t=(e-1+o.length)%o.length,n=(e+1)%o.length;M(o[t]),M(o[n])}}function M(e){const t=new Image;t.src=e}
