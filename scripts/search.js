const l={ANIMATION:{DEBOUNCE:150},SCORE:{EXACT_MATCH:10,WORD_BOUNDARY:5,WORD_START:3,PARTIAL_MATCH:1,TITLE_MULTIPLIER:3},CATEGORIES:{SEMANTIC:"semantic-colors",RAW:"raw-colors"}},u={currentValue:"",wasCleared:!1},E={ACTIVE_CATEGORY:".category.active",SEARCH_CONTAINER:".search-container",BLOC:".bloc"},C={searchBar:document.getElementById("search-bar"),fixedSearchBar:document.getElementById("fixedSearchBar"),clearButton:document.getElementById("clearSearch"),clearButtonFixed:document.getElementById("clearFixedSearch"),searchButton:document.getElementById("searchButton")},A=e=>e===l.CATEGORIES.SEMANTIC?l.CATEGORIES.RAW:l.CATEGORIES.SEMANTIC;function I(){const{searchBar:e,fixedSearchBar:t,clearButton:c,clearButtonFixed:r}=C,s=n=>{const a=n.target.value;u.currentValue=a,u.wasCleared=!1,M(a),f(n.target,a);const o=n.target===e?t:e;o.value=a,f(o,a)};[e,t].forEach(n=>{n&&n.addEventListener("input",s)});const i=n=>{u.currentValue="",u.wasCleared=!0,[e,t].forEach(a=>{a.value="",f(a,"")}),m(""),n.focus()};[{button:c,input:e},{button:r,input:t}].forEach(({button:n,input:a})=>{n==null||n.addEventListener("click",()=>i(a))})}function R(){const{searchButton:e,fixedSearchBar:t,clearButtonFixed:c}=C;e.addEventListener("click",()=>{const r=t.classList.contains("hidden");t.classList.toggle("hidden",!r),t.classList.toggle("show",r),r?(t.focus(),c.style.display=t.value.length>0?"block":"none"):c.style.display="none"})}function f(e,t){const c=C[e.id==="search-bar"?"clearButton":"clearButtonFixed"],r=t.length>0&&(e.id!=="fixedSearchBar"||e.classList.contains("show"));c.style.display=r?"block":"none"}const h=document.getElementById("fixedSearchBar");h&&(h.addEventListener("focus",()=>{h.dataset.isFocused="true"}),h.addEventListener("blur",()=>{h.dataset.isFocused="false"}));export const isFixedSearchFocused=()=>{var e;return((e=document.getElementById("fixedSearchBar"))==null?void 0:e.dataset.isFocused)==="true"};function L(e){return e.replace(/([^aeiou])ies$/,"$1y").replace(/([^aeiou])s$/,"$1").replace(/e?s$/,"")}function S(e){return e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim().split(" ").map(t=>L(t)).join(" "):""}function O(e,t){let c;return(...r)=>(clearTimeout(c),new Promise(s=>{c=setTimeout(()=>s(e(...r)),t)}))}const y={blocks:null,container:null,getBlocks(){const e=document.querySelector(E.ACTIVE_CATEGORY).id;return document.querySelectorAll(`#${e} ${E.BLOC}`)},getContainer(){const e=document.querySelector(".category.active").id;return document.getElementById(e)},clearCache(){this.blocks=null,this.container=null}};function T(e,t){if(!t)return e;const c=S(e),r=S(t),s=new RegExp(`(${r})`,"gi");return e.replace(s,"<mark>$1</mark>")}function p(e,t){const c=S(e),r=S(t),s=c.split(" "),i=r.split(" ");let n=0;return i.forEach(a=>{if(s.findIndex(d=>d===a)!==-1){n+=l.SCORE.EXACT_MATCH;return}if(new RegExp(`\\b${a}\\b`).test(c)){n+=l.SCORE.WORD_BOUNDARY;return}if(s.some(d=>d.startsWith(a))){n+=l.SCORE.WORD_START;return}s.some(d=>d.includes(a))&&(n+=l.SCORE.PARTIAL_MATCH)}),n}function B(e){const t=Array.from(e.children);t.sort((c,r)=>{const s=c.querySelector("h3").textContent.replace(/(\d+)/,(n,a)=>String(a).padStart(10,"0")),i=r.querySelector("h3").textContent.replace(/(\d+)/,(n,a)=>String(a).padStart(10,"0"));return s.localeCompare(i)}),t.forEach(c=>e.appendChild(c))}function m(e){const t=document.querySelector(".category.active").id,c=A(t),r=y.getBlocks(),s=document.querySelectorAll(`#${c} .bloc`),i=y.getContainer();if(r.forEach(o=>o.style.display="none"),s.forEach(o=>o.style.display="none"),!e){r.forEach(o=>{o.style.display="flex",o.querySelector("h3").innerHTML=o.dataset.originalTitle||o.querySelector("h3").textContent,o.querySelector(".description").innerHTML=o.dataset.originalDescription||o.querySelector(".description").textContent}),B(i),g("");return}const n={active:[],other:[]};r.forEach(o=>x(o,e,n.active)),s.forEach(o=>x(o,e,n.other)),n.active.sort((o,d)=>d.score-o.score),n.active.forEach(({block:o})=>{o.style.display="flex",i.appendChild(o)});const a=n.other.length>0?`Found ${n.other.length} matching result${n.other.length===1?"":"s"} in ${c.replace("-"," ")}`:"";g(a)}function x(e,t,c){e.dataset.originalTitle||(e.dataset.originalTitle=e.querySelector("h3").textContent,e.dataset.originalDescription=e.querySelector(".description").textContent);const r=e.dataset.originalTitle,s=e.dataset.originalDescription,i=p(r,t)*l.SCORE.TITLE_MULTIPLIER,n=p(s,t),a=i+n;a>0&&(e.querySelector("h3").innerHTML=T(e.dataset.originalTitle,t),e.querySelector(".description").innerHTML=T(e.dataset.originalDescription,t),c.push({block:e,score:a}))}function g(e){let t=document.getElementById("searchSubtext");t||(t=document.createElement("div"),t.id="searchSubtext",t.classList.add("search-subtext"),document.querySelector(E.SEARCH_CONTAINER).appendChild(t)),t.textContent=e,e?t.classList.add("visible"):t.classList.remove("visible")}function v(e){const t=document.getElementById(e);document.querySelectorAll(`#${e} .bloc`).forEach(r=>{r.style.display="flex",r.dataset.originalTitle&&(r.querySelector("h3").innerHTML=r.dataset.originalTitle,r.querySelector(".description").innerHTML=r.dataset.originalDescription)}),B(t)}const M=O(m,l.ANIMATION.DEBOUNCE);export const initSearch=()=>{const e=t=>{if(y.clearCache(),u.wasCleared||!u.currentValue)v(t.detail.category),g("");else{m(u.currentValue);const c=document.getElementById("searchSubtext").textContent;g(c)}};return I(),R(),document.addEventListener("categoryChange",e),()=>{document.removeEventListener("categoryChange",e)}};
