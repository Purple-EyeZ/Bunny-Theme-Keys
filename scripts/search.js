const CONSTANTS={ANIMATION:{DEBOUNCE:150},SCORE:{EXACT_MATCH:10,WORD_BOUNDARY:5,WORD_START:3,PARTIAL_MATCH:1,TITLE_MULTIPLIER:3},CATEGORIES:{SEMANTIC:"semantic-colors",RAW:"raw-colors"}},searchState={currentValue:"",wasCleared:!1},SELECTORS={ACTIVE_CATEGORY:".category.active",SEARCH_CONTAINER:".search-container",BLOC:".bloc"},elements={searchBar:document.getElementById("search-bar"),fixedSearchBar:document.getElementById("fixedSearchBar"),clearButton:document.getElementById("clearSearch"),clearButtonFixed:document.getElementById("clearFixedSearch"),searchButton:document.getElementById("searchButton")},getOtherCategory=e=>e===CONSTANTS.CATEGORIES.SEMANTIC?CONSTANTS.CATEGORIES.RAW:CONSTANTS.CATEGORIES.SEMANTIC;function addSearchFunctionality(){const{searchBar:e,fixedSearchBar:t,clearButton:r,clearButtonFixed:a}=elements,c=r=>{const a=r.target.value;searchState.currentValue=a,searchState.wasCleared=!1,debouncedFilter(a),toggleClearButton(r.target,a);const c=r.target===e?t:e;c.value=a,toggleClearButton(c,a)};[e,t].forEach((e=>{e&&e.addEventListener("input",c)}));[{button:r,input:e},{button:a,input:t}].forEach((({button:r,input:a})=>{r?.addEventListener("click",(()=>(r=>{searchState.currentValue="",searchState.wasCleared=!0,[e,t].forEach((e=>{e.value="",toggleClearButton(e,"")})),filterBlocks(""),r.focus()})(a)))}))}function addSearchButtonEvent(){const{searchButton:e,fixedSearchBar:t,clearButtonFixed:r}=elements;e.addEventListener("click",(()=>{const e=t.classList.contains("hidden");t.classList.toggle("hidden",!e),t.classList.toggle("show",e),e?(t.focus(),r.style.display=t.value.length>0?"block":"none"):r.style.display="none"}))}function toggleClearButton(e,t){const r=elements["search-bar"===e.id?"clearButton":"clearButtonFixed"],a=t.length>0&&("fixedSearchBar"!==e.id||e.classList.contains("show"));r.style.display=a?"block":"none"}const fixedSearchBar=document.getElementById("fixedSearchBar");fixedSearchBar&&(fixedSearchBar.addEventListener("focus",(()=>{fixedSearchBar.dataset.isFocused="true"})),fixedSearchBar.addEventListener("blur",(()=>{fixedSearchBar.dataset.isFocused="false"})));export const isFixedSearchFocused=()=>"true"===document.getElementById("fixedSearchBar")?.dataset.isFocused;function stemWord(e){return e.replace(/([^aeiou])ies$/,"$1y").replace(/([^aeiou])s$/,"$1").replace(/e?s$/,"")}function normalizeText(e){return e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim().split(" ").map((e=>stemWord(e))).join(" "):""}function debounce(e,t){let r;return(...a)=>(clearTimeout(r),new Promise((c=>{r=setTimeout((()=>c(e(...a))),t)})))}const cache={blocks:null,container:null,getBlocks(){const e=document.querySelector(SELECTORS.ACTIVE_CATEGORY).id;return document.querySelectorAll(`#${e} ${SELECTORS.BLOC}`)},getContainer(){const e=document.querySelector(".category.active").id;return document.getElementById(e)},clearCache(){this.blocks=null,this.container=null}};function highlightMatch(e,t){if(!t)return e;normalizeText(e);const r=normalizeText(t),a=new RegExp(`(${r})`,"gi");return e.replace(a,"<mark>$1</mark>")}function calculateScore(e,t){const r=normalizeText(e),a=normalizeText(t),c=r.split(" "),n=a.split(" ");let o=0;return n.forEach((e=>{-1===c.findIndex((t=>t===e))?new RegExp(`\\b${e}\\b`).test(r)?o+=CONSTANTS.SCORE.WORD_BOUNDARY:c.some((t=>t.startsWith(e)))?o+=CONSTANTS.SCORE.WORD_START:c.some((t=>t.includes(e)))&&(o+=CONSTANTS.SCORE.PARTIAL_MATCH):o+=CONSTANTS.SCORE.EXACT_MATCH})),o}function sortBlocks(e){const t=Array.from(e.children);t.sort(((e,t)=>{const r=e.querySelector("h3").textContent.replace(/(\d+)/,((e,t)=>String(t).padStart(10,"0"))),a=t.querySelector("h3").textContent.replace(/(\d+)/,((e,t)=>String(t).padStart(10,"0")));return r.localeCompare(a)})),t.forEach((t=>e.appendChild(t)))}function filterBlocks(e){const t=document.querySelector(".category.active").id,r=getOtherCategory(t),a=cache.getBlocks(),c=document.querySelectorAll(`#${r} .bloc`),n=cache.getContainer();if(a.forEach((e=>e.style.display="none")),c.forEach((e=>e.style.display="none")),!e)return a.forEach((e=>{e.style.display="flex",e.querySelector("h3").innerHTML=e.dataset.originalTitle||e.querySelector("h3").textContent,e.querySelector(".description").innerHTML=e.dataset.originalDescription||e.querySelector(".description").textContent})),sortBlocks(n),void updateSearchSubtext("");const o={active:[],other:[]};a.forEach((t=>processBlock(t,e,o.active))),c.forEach((t=>processBlock(t,e,o.other))),o.active.sort(((e,t)=>t.score-e.score)),o.active.forEach((({block:e})=>{e.style.display="flex",n.appendChild(e)}));updateSearchSubtext(o.other.length>0?`Found ${o.other.length} matching result${1===o.other.length?"":"s"} in ${r.replace("-"," ")}`:"")}function processBlock(e,t,r){e.dataset.originalTitle||(e.dataset.originalTitle=e.querySelector("h3").textContent,e.dataset.originalDescription=e.querySelector(".description").textContent);const a=e.dataset.originalTitle,c=e.dataset.originalDescription,n=calculateScore(a,t)*CONSTANTS.SCORE.TITLE_MULTIPLIER+calculateScore(c,t);n>0&&(e.querySelector("h3").innerHTML=highlightMatch(e.dataset.originalTitle,t),e.querySelector(".description").innerHTML=highlightMatch(e.dataset.originalDescription,t),r.push({block:e,score:n}))}function updateSearchSubtext(e){let t=document.getElementById("searchSubtext");t||(t=document.createElement("div"),t.id="searchSubtext",t.classList.add("search-subtext"),document.querySelector(SELECTORS.SEARCH_CONTAINER).appendChild(t)),t.textContent=e,e?t.classList.add("visible"):t.classList.remove("visible")}function resetBlocksDisplay(e){const t=document.getElementById(e);document.querySelectorAll(`#${e} .bloc`).forEach((e=>{e.style.display="flex",e.dataset.originalTitle&&(e.querySelector("h3").innerHTML=e.dataset.originalTitle,e.querySelector(".description").innerHTML=e.dataset.originalDescription)})),sortBlocks(t)}const debouncedFilter=debounce(filterBlocks,CONSTANTS.ANIMATION.DEBOUNCE);export const initSearch=()=>{const e=e=>{if(cache.clearCache(),searchState.wasCleared||!searchState.currentValue)resetBlocksDisplay(e.detail.category),updateSearchSubtext("");else{filterBlocks(searchState.currentValue);updateSearchSubtext(document.getElementById("searchSubtext").textContent)}};return addSearchFunctionality(),addSearchButtonEvent(),document.addEventListener("categoryChange",e),()=>{document.removeEventListener("categoryChange",e)}};